<!-- Navbar -->
<!-- Navbar -->
<nav
  class="navbar navbar-expand-lg navbar-dark sticky-top notranslate"
  translate="no"
  style="background-color: #0b0c10; border-bottom: 1px solid #1f2833"
>
  <div class="container px-3 px-lg-4">
    <!-- 1. Mobile Toggler (Left on Mobile) -->
    <button
      class="navbar-toggler border-0 order-0 me-2"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- 2. Brand (Left/Center) -->
    <a
      class="navbar-brand order-1 me-auto fw-bold d-flex align-items-center"
      href="/"
    >
      <i class="fas fa-gamepad text-aqua fa-lg"></i>
      <span class="ms-2 brand-text">COK'S</span>
    </a>

    <!-- 3. Right Side: Search, Notif, Profile (ALWAYS VISIBLE) -->
    <!-- Order-2 on mobile (Right), Order-lg-3 on Desktop (Right) -->
    <div class="d-flex align-items-center gap-3 gap-lg-4 order-2 order-lg-3">
      <!-- Search Icon (Link to Page) -->
      <a href="/search" class="text-white text-decoration-none">
        <i class="fas fa-search hover-aqua" style="font-size: 1.2rem"></i>
      </a>

      <% if (user) { %>
      <!-- Upload Icon (Restored) -->
      <a
        href="/games/create/new"
        class="text-white text-decoration-none"
        title="Upload Game"
      >
        <i
          class="fas fa-cloud-upload-alt hover-aqua"
          style="font-size: 1.2rem"
        ></i>
      </a>

      <!-- Notification Icon -->
      <div class="position-relative notification-btn cursor-pointer">
        <i
          class="fas fa-bell text-white hover-aqua"
          style="font-size: 1.2rem"
        ></i>
        <span
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
          id="notification-badge"
          style="display: none; font-size: 0.6rem"
        >
          0
        </span>
      </div>

      <!-- Profile Dropdown -->
      <div class="dropdown">
        <a
          href="#"
          class="d-flex align-items-center text-decoration-none"
          id="profileDropdown"
          data-bs-toggle="dropdown"
          aria-expanded="false"
        >
          <% if (user.avatar) { %>
          <img
            src="<%= user.avatar %>"
            alt="<%= user.name %>"
            class="rounded-circle border border-aqua"
            width="32"
            height="32"
            style="object-fit: cover"
          />
          <% } else { %>
          <i
            class="fas fa-user-circle fa-lg text-white"
            style="font-size: 1.8rem"
          ></i>
          <% } %>
        </a>

        <!-- Custom Dropdown Menu -->
        <ul
          class="dropdown-menu dropdown-menu-end custom-profile-menu mt-2 shadow-lg border-secondary bg-dark-secondary"
          aria-labelledby="profileDropdown"
        >
          <li class="px-3 py-2 border-bottom border-secondary">
            <div class="d-flex align-items-center">
              <% if (user.avatar) { %>
              <img
                src="<%= user.avatar %>"
                class="rounded-circle me-2"
                width="40"
                height="40"
                style="object-fit: cover"
              />
              <% } else { %>
              <i class="fas fa-user-circle fa-2x me-2 text-white"></i>
              <% } %>
              <div class="overflow-hidden">
                <div class="fw-bold text-white text-truncate">
                  <%= user.name %>
                </div>
                <small class="text-muted">Gamer</small>
              </div>
            </div>
          </li>
          <% if (user.role === 'admin') { %>
          <li>
            <a
              class="dropdown-item text-white hover-bg-dark d-flex align-items-center gap-2 py-3"
              href="/admin"
              ><i class="fas fa-shield-alt text-warning"></i> <span class="fw-bold">Admin Dashboard</span></a
            >
          </li>
          <li><hr class="dropdown-divider bg-secondary m-0" /></li>
          <% } %>
          <li>
            <a
              class="dropdown-item text-white hover-bg-dark"
              href="/profile/<%= user.id %>"
              ><i class="fas fa-user me-2 text-aqua"></i> My Profile</a
            >
          </li>
          <li>
            <a
              class="dropdown-item text-white hover-bg-dark"
              href="/payment/history"
              ><i class="fas fa-shopping-bag me-2 text-aqua"></i> My Orders</a
            >
          </li>
          <li>
            <a
              class="dropdown-item text-white hover-bg-dark"
              href="/profile/edit/me"
              ><i class="fas fa-cog me-2 text-aqua"></i> Settings</a
            >
          </li>
          <li><hr class="dropdown-divider bg-secondary" /></li>
          <li>
            <a class="dropdown-item text-danger hover-bg-dark" href="/logout"
              ><i class="fas fa-sign-out-alt me-2"></i> Logout</a
            >
          </li>
        </ul>
      </div>
      <% } else { %>
      <div class="d-flex gap-2">
        <a href="/login" class="btn btn-sm btn-outline-aqua btn-auth">Login</a>
        <!-- User Request: Only Login button on mobile -->
        <a
          href="/register"
          class="btn btn-sm btn-aqua btn-auth d-none d-lg-inline-block"
          >Register</a
        >
      </div>
      <% } %>
    </div>

    <!-- 4. Main Navigation Links (Collapsible) -->
    <!-- Order-3 on mobile (Bottom), Order-lg-2 on Desktop (Center) -->
    <div
      class="collapse navbar-collapse order-3 order-lg-2 justify-content-end justify-content-lg-center"
      id="navbarNav"
    >
      <ul class="navbar-nav mb-2 mb-lg-0 text-end text-lg-center">
        <li class="nav-item">
          <a
            class="nav-link <%= typeof page != 'undefined' && page === 'home' ? 'active' : '' %>"
            href="/"
            >Home</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link <%= typeof title != 'undefined' && title === 'Home' ? 'active' : '' %>"
            href="/games"
            >Games</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link <%= typeof page != 'undefined' && page === 'about' ? 'active' : '' %>"
            href="/about"
            >About</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link <%= typeof page != 'undefined' && page === 'community' ? 'active' : '' %>"
            href="/community"
            >Community</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link <%= typeof page != 'undefined' && page === 'faq' ? 'active' : '' %>"
            href="/faq"
            >FAQ</a
          >
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Search Modal -->
<div class="modal fade" id="searchModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content bg-dark border-aqua">
      <div class="modal-body p-4">
        <form action="/games" method="GET">
          <div class="input-group input-group-lg">
            <span
              class="input-group-text bg-dark-secondary border-aqua text-aqua"
              ><i class="fas fa-search"></i
            ></span>
            <input
              type="search"
              name="search"
              class="form-control bg-dark-secondary border-aqua text-white"
              placeholder="Search games, categories..."
              autofocus
            />
            <button class="btn btn-aqua" type="submit">Search</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Scripts -->
<script src="/js/notifications.js"></script>

<!-- Flash Messages -->
<% if (success) { %>
<div class="alert alert-success alert-dismissible fade show m-3" role="alert">
  <i class="fas fa-check-circle"></i> <%= success %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %> <% if (error) { %>
<div class="alert alert-danger alert-dismissible fade show m-3" role="alert">
  <i class="fas fa-exclamation-circle"></i> <%= error %>
  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
</div>
<% } %>

<style>
  /* Additional Navbar Styling */
  .hover-aqua:hover {
    color: #00adb5 !important;
    transition: 0.3s;
  }
  .bg-dark-secondary {
    background-color: #1a1a1d;
  }
  .hover-bg-dark:hover {
    background-color: #2d2d30 !important;
    color: #00adb5 !important;
  }
  .custom-profile-menu {
    min-width: 250px;
  }
  /* Ensure search input group looks unified */
  .input-group-text {
    border-right: none;
  }
  .input-group .form-control {
    border-left: none;
  }
</style>
